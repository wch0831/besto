<?xml version="1.0" encoding="UTF-8" ?> 
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">


<mapper namespace="com.com.mapper.GameMapper">
	<resultMap id="matchMap" type="com.com.game.MatchVO">
		<id 	property="matchSeq" 		column="match_seq" />
		<result property="gameSeq" 		column="game_seq" />
		<result property="matchStarttime" 		column="match_starttime" />
		<result property="matchHometeam" 	column="match_hometeam" />
		<result property="matchAwayteam" 	column="match_awayteam" />
		<result property="matchVsrecord" 	column="match_vsrecord" />
		<result property="matchStadium" 		column="match_stadium" />
		<result property="matchStatus" 		column="match_status" />
		<result property="usersSeq" 		column="users_seq" />

		<result property="gameCount" 		column="game_count" />
		<result property="homeTeamName" 		column="homeTeamName" />
		<result property="awayTeamName" 		column="awayTeamName" />
				

		<result property="gameGubun" 		column="game_gubun" />
		<result property="victoryrateWin" 		column="victoryrate_win" />
		<result property="victoryrateDraw" 		column="victoryrate_draw" />
		<result property="victoryrateLose" 		column="victoryrate_lose" />
	</resultMap>
	
	<resultMap id="gameMap" type="com.com.game.GameVO">
		<id 	property="gameSeq" 		column="game_seq" />
		<result property="gameGubun" 		column="game_gubun" />
		<result property="gameFinishdate" 		column="game_finishdate" />
		<result property="gameStatus" 	column="game_status" />
		<result property="gameRoundseq" 	column="game_roundseq" />
		<result property="gameRegdate" 	column="game_regdate" />
		<result property="usersSeq" 		column="users_seq" />			
	</resultMap>
	
	<resultMap id="teamMap" type="com.com.game.TeamVO">
		<id 	property="tCode" 		column="t_code" />
		<result property="tName" 		column="t_name" />
	</resultMap>		
	
	<resultMap id="gameMap_1n" type="com.com.game.GameVO" extends="gameMap">
		<collection property="matchlist" resultMap="matchMap"/>
	</resultMap>
	
	<resultMap id="gameTeamMap_11n" type="com.com.game.GameVO" extends="gameMap">
		<collection property="matchlist" resultMap="record_11"/>
	</resultMap>
	
	<resultMap id="victory_11" type="com.com.game.MatchVO" extends="matchMap">
		<association property="vicVO" resultMap="victoryRateMap"/>
	</resultMap>
	
	<resultMap id="record_11" type="com.com.game.MatchVO" extends="matchMap">
		<association property="recVO" resultMap="recordRateMap"/>
	</resultMap>
	
	<resultMap id="recordRateMap" type="com.com.game.RecordRateVO">
		<id 	property="matchSeq" 		column="match_seq" />
		<result property="recoderate00" 		column="recoderate_00" />
		<result property="recoderate10" 		column="recoderate_10" />
		<result property="recoderate20" 	column="recoderate_20" />
		<result property="recoderate11" 	column="recoderate_11" />
		<result property="recoderate22" 	column="recoderate_22" />
		<result property="recoderate01" 		column="recoderate_01" />
		<result property="recoderate02" 		column="recoderate_02" />				
	</resultMap>	
	
	<resultMap id="victoryRateMap" type="com.com.game.VictoryRateVO">
		<id 	property="matchSeq" 		column="match_seq" />
		<result property="victoryrateWin" 		column="victoryrate_win" />
		<result property="victoryrateDraw" 		column="victoryrate_draw" />
		<result property="victoryrateLose" 	column="victoryrate_lose" />			
	</resultMap>
	
	<resultMap id="bettingBuyMap" type="com.com.game.BettingVO">
		<id 	property="bettingSeq" 		column="betting_seq" />
		<result property="bettingContent" 		column="betting_content" />
		<result property="bettingPrice" 		column="betting_price" />
		<result property="bettingRegdate" 	column="betting_regdate" />			
		<result property="bettingHityn" 	column="betting_hityn" />	
		<result property="bettingHitrate" 	column="betting_hitrate" />	
		<result property="gameSeq" 	column="game_seq" />	
		<result property="usersSeq" 	column="users_seq" />	
	</resultMap>		

	
 	<sql id="commonSelect">user_name, user_gubun</sql>
 	
 	<!-- 게임 insert -->
	<insert id="gameInsert" parameterType="com.com.game.GameVO">
		insert into game(game_seq, game_gubun, game_finishdate, game_status, game_roundseq, game_regdate)
		values(game_seq.nextval, #{gameGubun}, #{gameFinishdate}, 'p', 
			<if test='gameGubun.equals("v")'>
	      		victory_seq.nextval 
	      	</if>
	      	<if test='gameGubun.equals("r")'>
	      		record_seq.nextval 
	      	</if>
		, sysdate)
	</insert>
	
	<!-- 매치 insert -->
	<insert id="matchInsert" parameterType="com.com.game.MatchVO">
		insert into match(match_seq, game_seq, match_starttime, match_hometeam, match_awayteam, match_stadium, match_status, game_mno)
		values(#{matchSeq}, #{gameSeq}, #{matchStarttime}, #{matchHometeam}, #{matchAwayteam}, #{matchStadium}, 'p', #{gameMno})
	</insert>
	
	
	
	<!-- 승부식 배당률 insert -->
	<insert id="victoryRateInsert" parameterType="com.com.game.VictoryRateVO">
		insert into victoryrate(match_seq, victoryrate_win, victoryrate_draw, victoryrate_lose)
		values(#{matchSeq}, #{victoryrateWin}, #{victoryrateDraw}, #{victoryrateLose})
	</insert>
	
	<!-- 기록식 배당률 insert -->
	<insert id="recordRateInsert" parameterType="com.com.game.RecordRateVO">
		insert into recoderate(match_seq, recoderate_00, recoderate_10, recoderate_20, recoderate_11, recoderate_22, recoderate_01, recoderate_02)
		values(#{matchSeq}, #{recoderate00}, #{recoderate10}, #{recoderate20}, #{recoderate11}, #{recoderate22}, #{recoderate01}, #{recoderate02})
	</insert>
	
	<!-- 기록식 게임 구매사항 insert -->
	<insert id="recordBuyInsert" parameterType="com.com.game.RecordRateVO">
		insert into betting(betting_seq, betting_content, betting_price, betting_hityn, betting_hitrate, game_seq, users_seq)
    	values(#{bettingSeq}, #{bettingContent}, #{bettingPrice}, #{bettingHityn}, #{bettingHitrate}, #{gameSeq}, #{usersSeq})
	</insert>
	
	
	
	<!-- 경기 불러오기.  g.game_status = 'f' 수정해야한다. -->
 	<select id="gameInsertSelect" parameterType="com.com.game.GameVO" resultMap="matchMap">
 		select m.match_starttime, m.match_hometeam, m.match_awayteam, v.victoryrate_win, v.victoryrate_draw, v.victoryrate_lose, m.match_stadium
		from game g, match m, victoryrate v
		where g.game_seq = m.game_seq and m.match_seq = v.match_seq and g.game_seq = #{gameSeq} and g.game_status = 'f'
 	</select>
 	
 	<!-- game_seq를 list에 강제로 넣어주기 위한 seq select -->
 	<select id="SelectSeq" resultType="int">
 		select max(game_seq) as game_seq
    	from game
 	</select>
 	
 	<!-- insert시 match가 있는지 없는지 비교하기 위한 list selct -->
 	<select id="selectMseqList" resultMap="matchMap">
    	select m.match_seq, m.game_seq, g.game_gubun
    	from match m , game g
    	where m.game_seq = g.game_seq
 	</select>
 	
 	<!-- 기록식 구매하기를 클릭시 정보를 보여주기 위한 list select -->
 	<select id="selectRecordSelect" parameterType="int" resultMap="gameTeamMap_11n">
    	select m.match_seq, m.game_seq, m.match_stadium,
   		(select t.t_name from team t where t.t_code = m.match_hometeam) as homeTeamName,
    	(select t.t_name from team t where t.t_code = m.match_awayteam) as awayTeamName,
    	r.recoderate_00, r.recoderate_01, r.recoderate_02, r.recoderate_10, r.recoderate_11, r.recoderate_20, r.recoderate_22
    	from game g, match m, recoderate r
    	where m.game_seq = g.game_seq(+) and r.match_seq = m.match_seq(+)
    	and m.game_seq = #{value}
 	</select>
 	
 	
 
 
 	
 	<!-- 멤버 로그인 -->
 	<select id="availableGame" resultMap="gameMap">
 		select *
 		from game
 		where game_status='p'
 	</select>
 	
 <!-- 	<select id="objectGame" parameterType="com.com.game.GameVO" resultMap="matchMap">
 		select match_starttime,match_hometeam,match_awayteam,match_stadium
		from match
		where game_seq=#{gameSeq};
 	</select>
	-->
	<!-- <select id="buyNoteRecordRate" parameterType="com.com.game.GameVO" resultMap="RecodeRateMap">
 		select *
		from game g, match m, recoderate rr
		where g.game_seq=1;
		and g.game_seq=m.game_seq
		and rr.match_seq=m.match_seq;
 	</select> -->	 

	
</mapper>	

